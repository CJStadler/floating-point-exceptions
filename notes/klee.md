Steps:
1. Generate SMT
2. Solve to get input candidates
3. Test inputs on P and P', searching if necessary

- Ariadne modified KLEE to use Z3 because it has a theory of reals.
- KLEE supports Z3, but not treating floats as reals.
- How to generate SMT?
  1. Modify KLEE to use Real type for floats (like Ariadne).
  2. Generate SMT by hand.

- How to compare P and P'?
  - Exception traces
  - Any exceptions?
  - Compare outputs.

- Could we solve for inputs that generate an exception in only one of P and P'?

- Compare exception traces just using order of exceptions (no line numbers).
- Two traces are equivalent if they have exceptions in the same order.

## TODO
- What do the formulas generated by KLEE-FP look like? How easy to translate to
  Real formulas?
- Try uninterpreted function with KLEE
- Try with manually instrumented
- Then implement LLVM pass

Int hack:
1. `double` -> `int` in source
2. Instrument IR with checks
3. Run KLEE to get SMT
4. `int` -> `real` in SMT

## Implementations

- Ariadne

- KLEE-FP
  - P. Collingbourne, C. Cadar, and P. H. Kelly, “Symbolic crosschecking offloating-point and SIMD code,” inProc. of the 6th European Conferenceon Computer Systems (EuroSys’11), Apr. 2011.
  - From Imperial College
  - Doesn't use Z3, implemented their own algorithm
  - https://web.archive.org/web/20180117130640/http://www.pcc.me.uk/~peter/klee-fp/

- KLEE-float from Imperial College
  - Uses Z3
  - https://github.com/srg-imperial/klee-float
  - https://www.mail-archive.com/klee-dev@imperial.ac.uk/msg02745.html#

- KLEE-float from Aachen University
  - Uses Z3
  - https://github.com/comsys/klee-float

## Notes

- Example of z3 FP syntax: https://blog.janestreet.com/proofs-and-refutations-using-z3/

- Klee treats ints as bitvectors in the smt.
  - See https://www.mail-archive.com/klee-dev@imperial.ac.uk/msg02861.html and
    http://mailman.ic.ac.uk/pipermail/klee-dev/2013-April/000141.html
- Converting the bitvector formulas into formulas over the reals seems doable
  but it's not a simple find+replace.
- `bv2int` and `int2bv`.

- KLEE-float (Imperial) has `z3-query-dump` flag to get smt:
  `klee -z3-query-dump=query.smt2 foo.bc`
  - The symbolic vars are represented as bit vectors and converted to float.

- Try the Aachen KLEE-float?
  - See https://github.com/COMSYS/klee-float/commit/612fcadcbd69f921f5b6bc0577dc5f770cd10489

## Float smt2 -> Real smt2

- Change variable types to `Real`
- Wrap constants in `fp.to_real`
- Translate `fp.*` functions

## TODO

- Simple grammer: straight line, SSA
- Translate from LLVM to smt
